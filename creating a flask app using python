from flask import Flask, render_template, request
from weather import get_weather
from waitress import serve

app = Flask(__name__)

@app.route("/")
@app.route("/index")
def index():
    return render_template('weather.html', title=None, status=None, temp=None, feels_like=None)

@app.route("/weather")
def get_current_weather():
    city = request.args.get('city')

    # check for None, empty strings or string with only spaces
    if not city or not city.strip():
        city = 'kampala'

    weather_data = get_weather(city)

    # city is not found by the API
    if weather_data.get('cod') != 200:
        return render_template(
            'weather.html',
            title="City Not Found",
            status="",
            temp="",
            feels_like=""
        )

    return render_template(
        'weather.html',
        title=weather_data['name'],
        status=weather_data['weather'][0]['description'].capitalize(),
        temp=f"{weather_data['main']['temp']:.1f}",
        feels_like=f"{weather_data['main']['feels_like']}"
    )


if __name__ == "__main__":
    app.run(host='0.0.0.0', port=8000)
